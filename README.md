# Wecomé…±

é€šè¿‡ä¼ä¸šå¾®ä¿¡å‘å¾®ä¿¡æ¨é€æ¶ˆæ¯çš„è§£å†³æ–¹æ¡ˆã€‚åŒ…æ‹¬ï¼š

1. é…ç½®è¯´æ˜ï¼ˆæœ¬é¡µä¸‹æ–¹ï¼‰
2. æ¨é€å‡½æ•°ï¼ˆæ”¯æŒå¤šç§è¯­è¨€ï¼Œè§æœ¬é¡µä¸‹æ–¹ï¼‰
3. è‡ªè¡Œæ­å»ºçš„åœ¨çº¿æœåŠ¡æºç  
   1. [PHPç‰ˆæ­å»ºè¯´æ˜](ONLINE.md) 
   2. [Goç‰ˆè¯´æ˜](go-wecomchan/README.md)
   3. [Goé€‚é…åä¸ºå‡½æ•°å·¥ä½œæµç‰ˆæœ¬](https://github.com/Colo-Thor/wecomchan/releases/tag/2.2)
   4. [é˜¿é‡Œäº‘äº‘å‡½æ•°æ­å»ºè¯´æ˜](python-aliyunfc/)
   5. [è…¾è®¯äº‘äº‘å‡½æ•°æ­å»ºè¯´æ˜](go-scf/) âš ï¸ 2022å¹´5æœˆ23æ—¥èµ·æœ€ä½æœˆæ¶ˆè´¹9.9ï¼Œå› æ­¤ä¸æ¨èäº† 
   6. [ç™¾åº¦æ™ºèƒ½äº‘å‡½æ•°æ­å»ºè¯´æ˜](python-baiduCFC/)

## ğŸˆ æœ¬é¡¹ç›®å±äºæ–¹ç³–æ¨é€ç”Ÿæ€ã€‚è¯¥ç”Ÿæ€åŒ…å«é¡¹ç›®å¦‚ä¸‹ï¼š

- [Serveré…±Turbo](https://sct.ftqq.com)ï¼šæ”¯æŒä¼ä¸šå¾®ä¿¡ã€å¾®ä¿¡æœåŠ¡å·ã€é’‰é’‰ã€é£ä¹¦ç¾¤æœºå™¨äººç­‰å¤šé€šé“çš„åœ¨çº¿æœåŠ¡ï¼Œæ— éœ€æ­å»ºç›´æ¥ä½¿ç”¨ï¼Œæ¯å¤©æœ‰å…è´¹é¢åº¦
- [Wecomé…±](https://github.com/easychen/wecomchan)ï¼šé€šè¿‡ä¼ä¸šå¾®ä¿¡æ¨é€æ¶ˆæ¯åˆ°å¾®ä¿¡çš„æ¶ˆæ¯æ¨é€å‡½æ•°å’Œåœ¨çº¿æœåŠ¡æ–¹æ¡ˆï¼Œå¼€æºå…è´¹ï¼Œå¯è‡ªå·±æ­å»ºã€‚æ”¯æŒå¤šè¯­è¨€ã€‚
- [PushDeer](https://github.com/easychen/pushdeer)ï¼šå¯è‡ªè¡Œæ­å»ºçš„ã€æ— éœ€å®‰è£…APPçš„å¼€æºæ¨é€æ–¹æ¡ˆã€‚åŒæ—¶ä¹Ÿæä¾›å®‰è£…APPçš„é™çº§æ–¹æ¡ˆç»™ä½ç‰ˆæœ¬/æ²¡æœ‰å¿«åº”ç”¨çš„ç³»ç»Ÿã€‚æ”¯æŒä½œä¸ºServeré…±çš„é€šé“è¿›è¡Œæ¨é€ï¼Œæ‰€æœ‰æ”¯æŒServeré…±çš„è½¯ä»¶å’Œæ’ä»¶éƒ½èƒ½ç›´æ¥æ•´åˆPushDeerã€‚

## ä¼ä¸šå¾®ä¿¡åº”ç”¨æ¶ˆæ¯é…ç½®è¯´æ˜

ä¼˜ç‚¹ï¼š

1. ä¸€æ¬¡é…ç½®ï¼ŒæŒç»­ä½¿ç”¨
1. é…ç½®å¥½ä»¥åï¼Œåªéœ€è¦å¾®ä¿¡å°±èƒ½æ”¶æ¶ˆæ¯ï¼Œä¸å†éœ€è¦å®‰è£…ä¼ä¸šå¾®ä¿¡å®¢æˆ·ç«¯

PSï¼šæ¶ˆæ¯æ¥å£æ— éœ€è®¤è¯å³å¯ä½¿ç”¨ï¼Œä¸ªäººç”¨å¾®ä¿¡å°±å¯ä»¥æ³¨å†Œ

### å…·ä½“æ“ä½œ

#### ç¬¬ä¸€æ­¥ï¼Œæ³¨å†Œä¼ä¸š

ç”¨ç”µè„‘æ‰“å¼€[ä¼ä¸šå¾®ä¿¡å®˜ç½‘](https://work.weixin.qq.com/)ï¼Œæ³¨å†Œä¸€ä¸ªä¼ä¸š

#### ç¬¬äºŒæ­¥ï¼Œåˆ›å»ºåº”ç”¨

æ³¨å†ŒæˆåŠŸåï¼Œç‚¹ã€Œç®¡ç†ä¼ä¸šã€è¿›å…¥ç®¡ç†ç•Œé¢ï¼Œé€‰æ‹©ã€Œåº”ç”¨ç®¡ç†ã€ â†’ ã€Œè‡ªå»ºã€ â†’  ã€Œåˆ›å»ºåº”ç”¨ã€

![](https://theseven.ftqq.com/20210208143228.png)

åº”ç”¨åç§°å¡«å…¥ã€ŒServeré…±ã€ï¼Œåº”ç”¨logoåˆ°[è¿™é‡Œ](./20210208142819.png)ä¸‹è½½ï¼Œå¯è§èŒƒå›´é€‰æ‹©å…¬å¸åã€‚


![](https://theseven.ftqq.com/20210208143327.png)

åˆ›å»ºå®Œæˆåè¿›å…¥åº”ç”¨è¯¦æƒ…é¡µï¼Œå¯ä»¥å¾—åˆ°åº”ç”¨ID( `agentid` )â‘ ï¼Œåº”ç”¨Secret( `secret` )â‘¡ã€‚

æ³¨æ„ï¼š`secret`æ¨é€åˆ°æ‰‹æœºç«¯æ—¶ï¼Œåªèƒ½åœ¨`ä¼ä¸šå¾®ä¿¡å®¢æˆ·ç«¯`ä¸­æŸ¥çœ‹ã€‚

#### ç¬¬ä¸‰æ­¥ï¼Œæ·»åŠ å¯ä¿¡IP

> 2022å¹´6æœˆ20æ—¥ä¹‹ååˆ›å»ºçš„åº”ç”¨ï¼Œéœ€è¦é¢å¤–é…ç½®å¯ä¿¡IPã€‚

åœ¨ã€Œåº”ç”¨è¯¦æƒ…é¡µã€çš„æœ€ä¸‹æ–¹ï¼Œå¼€å‘è€…æ¥å£åˆ†ç±»ä¸­ï¼Œæ‰¾åˆ°ã€Œä¼ä¸šå¯ä¿¡IPã€ï¼Œç‚¹å‡»ã€Œé…ç½®ã€ï¼Œå¹¶å¡«å…¥æœåŠ¡å™¨IPå³å¯ã€‚

æ³¨æ„ï¼Œå¦‚æœä½ ä½¿ç”¨äº‘å‡½æ•°ç­‰å…¬ç”¨IPçš„äº‘æœåŠ¡ï¼Œå¯èƒ½éœ€è¦åœ¨ï¼ˆäº‘å‡½æ•°æˆ–å…¶ä»–æœåŠ¡çš„ï¼‰è®¾ç½®ç•Œé¢ä¸­æ‰“å¼€ã€Œå›ºå®šå…¬ç½‘IPã€æ¥è·å¾—ä¸€ä¸ªç‹¬ç«‹çš„IPã€‚å¦åˆ™æœ‰å¯èƒ½æŠ¥ã€Œç¬¬ä¸‰æ–¹æœåŠ¡IPã€é”™è¯¯ã€‚

#### ç¬¬å››æ­¥ï¼Œè·å–ä¼ä¸šID

è¿›å…¥ã€Œ[æˆ‘çš„ä¼ä¸š](https://work.weixin.qq.com/wework_admin/frame#profile)ã€é¡µé¢ï¼Œæ‹‰åˆ°æœ€ä¸‹è¾¹ï¼Œå¯ä»¥çœ‹åˆ°ä¼ä¸šIDâ‘¢ï¼Œå¤åˆ¶å¹¶å¡«åˆ°ä¸Šæ–¹ã€‚

æ¨é€UIDç›´æ¥å¡« `@all` ï¼Œæ¨é€ç»™å…¬å¸å…¨å‘˜ã€‚

#### ç¬¬äº”æ­¥ï¼Œæ¨é€æ¶ˆæ¯åˆ°å¾®ä¿¡

è¿›å…¥ã€Œæˆ‘çš„ä¼ä¸šã€ â†’ ã€Œ[å¾®ä¿¡æ’ä»¶](https://work.weixin.qq.com/wework_admin/frame#profile/wxPlugin)ã€ï¼Œæ‹‰åˆ°ä¸‹è¾¹æ‰«æäºŒç»´ç ï¼Œå…³æ³¨ä»¥åå³å¯æ”¶åˆ°æ¨é€çš„æ¶ˆæ¯ã€‚

![](https://theseven.ftqq.com/20210208144808.png)

PSï¼šå¦‚æœå‡ºç°`æ¥å£è¯·æ±‚æ­£å¸¸ï¼Œä¼ä¸šå¾®ä¿¡æ¥å—æ¶ˆæ¯æ­£å¸¸ï¼Œä¸ªäººå¾®ä¿¡æ— æ³•æ”¶åˆ°æ¶ˆæ¯`çš„æƒ…å†µï¼š

1. è¿›å…¥ã€Œæˆ‘çš„ä¼ä¸šã€ â†’ ã€Œ[å¾®ä¿¡æ’ä»¶](https://work.weixin.qq.com/wework_admin/frame#profile/wxPlugin)ã€ï¼Œæ‹‰åˆ°æœ€ä¸‹æ–¹ï¼Œå‹¾é€‰ â€œå…è®¸æˆå‘˜åœ¨å¾®ä¿¡æ’ä»¶ä¸­æ¥æ”¶å’Œå›å¤èŠå¤©æ¶ˆæ¯â€
![](https://img.ams1.imgbed.xyz/2021/06/01/HPIRU.jpg)

2. åœ¨ä¼ä¸šå¾®ä¿¡å®¢æˆ·ç«¯ ã€Œæˆ‘ã€ â†’ ã€Œè®¾ç½®ã€  â†’ ã€Œæ–°æ¶ˆæ¯é€šçŸ¥ã€ä¸­å…³é—­ â€œä»…åœ¨ä¼ä¸šå¾®ä¿¡ä¸­æ¥å—æ¶ˆæ¯â€ é™åˆ¶æ¡ä»¶
![](https://img.ams1.imgbed.xyz/2021/06/01/HPKPX.jpg)

#### ç¬¬å…­æ­¥ï¼Œé€šè¿‡ä»¥ä¸‹å‡½æ•°å‘é€æ¶ˆæ¯ï¼š

PSï¼šä¸ºä½¿ç”¨æ–¹ä¾¿ï¼Œä»¥ä¸‹å‡½æ•°æ²¡æœ‰å¯¹ `access_token` è¿›è¡Œç¼“å­˜ã€‚å¯¹äºä¸ªäººä½é¢‘è°ƒç”¨å·²ç»å¤Ÿç”¨ã€‚å¸¦ç¼“å­˜çš„å®ç°å¯æŸ¥çœ‹ `index.php` ä¸­çš„ç¤ºä¾‹ä»£ç ï¼ˆä¾èµ–Rediså®ç°ï¼‰ã€‚

PHPç‰ˆï¼š

```php
function send_to_wecom($text, $wecom_cid, $wecom_aid, $wecom_secret,  $wecom_touid = '@all')
{
    $info = @json_decode(file_get_contents("https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=".urlencode($wecom_cid)."&corpsecret=".urlencode($wecom_secret)), true);
                
    if ($info && isset($info['access_token']) && strlen($info['access_token']) > 0) {
        $access_token = $info['access_token'];
        $url = 'https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token='.urlencode($access_token);
        $data = new \stdClass();
        $data->touser = $wecom_touid;
        $data->agentid = $wecom_aid;
        $data->msgtype = "text";
        $data->text = ["content"=> $text];
        $data->duplicate_check_interval = 600;

        $data_json = json_encode($data);
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-Type: application/json']);
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        @curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_TIMEOUT, 5);
        curl_setopt($ch, CURLOPT_POSTFIELDS, $data_json);

        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
        
        $response = curl_exec($ch);
        return $response;
    }
    return false;
}

```

ä½¿ç”¨å®ä¾‹ï¼š

```php
$ret = send_to_wecom("æ¨é€æµ‹è¯•\r\næµ‹è¯•æ¢è¡Œ", "ä¼ä¸šIDâ‘¢", "åº”ç”¨IDâ‘ ", "åº”ç”¨secretâ‘¡");
print_r( $ret );
```

PYTHONç‰ˆ:

```python
import json,requests,base64
def send_to_wecom(text,wecom_cid,wecom_aid,wecom_secret,wecom_touid='@all'):
    get_token_url = f"https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid={wecom_cid}&corpsecret={wecom_secret}"
    response = requests.get(get_token_url).content
    access_token = json.loads(response).get('access_token')
    if access_token and len(access_token) > 0:
        send_msg_url = f'https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token={access_token}'
        data = {
            "touser":wecom_touid,
            "agentid":wecom_aid,
            "msgtype":"text",
            "text":{
                "content":text
            },
            "duplicate_check_interval":600
        }
        response = requests.post(send_msg_url,data=json.dumps(data)).content
        return response
    else:
        return False

def send_to_wecom_image(base64_content,wecom_cid,wecom_aid,wecom_secret,wecom_touid='@all'):
    get_token_url = f"https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid={wecom_cid}&corpsecret={wecom_secret}"
    response = requests.get(get_token_url).content
    access_token = json.loads(response).get('access_token')
    if access_token and len(access_token) > 0:
        upload_url = f'https://qyapi.weixin.qq.com/cgi-bin/media/upload?access_token={access_token}&type=image'
        upload_response = requests.post(upload_url, files={
            "picture": base64.b64decode(base64_content)
        }).json()
        if "media_id" in upload_response:
            media_id = upload_response['media_id']
        else:
            return False

        send_msg_url = f'https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token={access_token}'
        data = {
            "touser":wecom_touid,
            "agentid":wecom_aid,
            "msgtype":"image",
            "image":{
                "media_id": media_id
            },
            "duplicate_check_interval":600
        }
        response = requests.post(send_msg_url,data=json.dumps(data)).content
        return response
    else:
        return False

def send_to_wecom_markdown(text,wecom_cid,wecom_aid,wecom_secret,wecom_touid='@all'):
    get_token_url = f"https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid={wecom_cid}&corpsecret={wecom_secret}"
    response = requests.get(get_token_url).content
    access_token = json.loads(response).get('access_token')
    if access_token and len(access_token) > 0:
        send_msg_url = f'https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token={access_token}'
        data = {
            "touser":wecom_touid,
            "agentid":wecom_aid,
            "msgtype":"markdown",
            "markdown":{
                "content":text
            },
            "duplicate_check_interval":600
        }
        response = requests.post(send_msg_url,data=json.dumps(data)).content
        return response
    else:
        return False
```

ä½¿ç”¨å®ä¾‹ï¼š

```python
ret = send_to_wecom("æ¨é€æµ‹è¯•\r\næµ‹è¯•æ¢è¡Œ", "ä¼ä¸šIDâ‘¢", "åº”ç”¨IDâ‘ ", "åº”ç”¨secretâ‘¡");
print( ret );
ret = send_to_wecom('<a href="https://www.github.com/">æ–‡æœ¬ä¸­æ”¯æŒè¶…é“¾æ¥</a>', "ä¼ä¸šIDâ‘¢", "åº”ç”¨IDâ‘ ", "åº”ç”¨secretâ‘¡");
print( ret );
ret = send_to_wecom_image("æ­¤å¤„å¡«å†™å›¾ç‰‡Base64", "ä¼ä¸šIDâ‘¢", "åº”ç”¨IDâ‘ ", "åº”ç”¨secretâ‘¡");
print( ret );
ret = send_to_wecom_markdown("**Markdown å†…å®¹**", "ä¼ä¸šIDâ‘¢", "åº”ç”¨IDâ‘ ", "åº”ç”¨secretâ‘¡");
print( ret );
```

TypeScript ç‰ˆ:

```typescript
import request from 'superagent'

async function sendToWecom(body: {
  text: string
  wecomCId: string
  wecomSecret: string
  wecomAgentId: string
  wecomTouid?: string
}): Promise<{ errcode: number; errmsg: string; invaliduser: string }> {
  body.wecomTouid = body.wecomTouid ?? '@all'
  const getTokenUrl = `https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=${body.wecomCId}&corpsecret=${body.wecomSecret}`
  const getTokenRes = await request.get(getTokenUrl)
  const accessToken = getTokenRes.body.access_token
  if (accessToken?.length <= 0) {
    throw new Error('è·å– accessToken å¤±è´¥')
  }
  const sendMsgUrl = `https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=${accessToken}`
  const sendMsgRes = await request.post(sendMsgUrl).send({
    touser: body.wecomTouid,
    agentid: body.wecomAgentId,
    msgtype: 'text',
    text: {
      content: body.text,
    },
    duplicate_check_interval: 600,
  })
  return sendMsgRes.body
}
```

ä½¿ç”¨å®ä¾‹ï¼š

```typescript
sendToWecom({
  text: 'æ¨é€æµ‹è¯•\r\næµ‹è¯•æ¢è¡Œ',
  wecomAgentId: 'åº”ç”¨IDâ‘ ',
  wecomSecret: 'åº”ç”¨secretâ‘¡',
  wecomCId: 'ä¼ä¸šIDâ‘¢',
})
  .then((res) => {
    console.log(res)
  })
  .catch((err) => {
    console.log(err)
  })
```

.NET Core ç‰ˆ:

```C#
using System;
using RestSharp;
using Newtonsoft.Json;
namespace WeCom.Demo
{
    class WeCom
    {   
        public  string SendToWeCom(
            string text,// æ¨é€æ¶ˆæ¯
            string weComCId,// ä¼ä¸šIdâ‘ 
            string weComSecret,// åº”ç”¨secretâ‘¡
            string weComAId,// åº”ç”¨IDâ‘¢
            string weComTouId = "@all")
        {
            // è·å–Token
            string getTokenUrl = $"https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid={weComCId}&corpsecret={weComSecret}";
            string token = JsonConvert
            .DeserializeObject<dynamic>(new RestClient(getTokenUrl)
            .Get(new RestRequest()).Content).access_token;
            System.Console.WriteLine(token);
            if (!String.IsNullOrWhiteSpace(token))
            {
                var request = new RestRequest();
                var client = new RestClient($"https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token={token}");
                var data = new
                {
                    touser = weComTouId,
                    agentid = weComAId,
                    msgtype = "text",
                    text = new
                    {
                        content = text
                    },
                    duplicate_check_interval = 600
                };
                string serJson = JsonConvert.SerializeObject(data);
                System.Console.WriteLine(serJson);
                request.Method = Method.POST;
                request.AddHeader("Accept", "application/json");
                request.Parameters.Clear();
                request.AddParameter("application/json", serJson, ParameterType.RequestBody);
                return client.Execute(request).Content;
            }
            return "-1";
        }
}


```
ä½¿ç”¨å®ä¾‹:
```C#
   static void Main(string[] args)
        {   // æµ‹è¯•
            Console.Write(new WeCom().SendToWeCom(
            "msginfo",
            "ä¼ä¸šIdâ‘ "
            , "åº”ç”¨secretâ‘¡",
            "åº”ç”¨IDâ‘¢"
            ));
        }

    }
```

- [çº¯Bashç‰ˆæœ¬å‚è€ƒ](https://gitee.com/Hemingway2003/pushservice/blob/master/wecom.sh)

å…¶ä»–ç‰ˆæœ¬çš„å‡½æ•°å¯å‚ç…§ä¸Šè¾¹çš„é€»è¾‘è‡ªè¡Œç¼–å†™ï¼Œæ¬¢è¿PRã€‚

å‘é€å›¾ç‰‡ã€å¡ç‰‡ã€æ–‡ä»¶æˆ– Markdown æ¶ˆæ¯çš„é«˜çº§ç”¨æ³•è§ [ä¼ä¸šå¾®ä¿¡API](https://work.weixin.qq.com/api/doc/90000/90135/90236)ã€‚



